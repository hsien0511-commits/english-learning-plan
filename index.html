<!DOCTYPE html><!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12é€±è‹±èªæŒ‘æˆ°ï¼šè©•åˆ†ç®¡ç†ç‰ˆ</title>
    <style>
        :root {
            --bg: #121212; --card: #1e1e1e; --accent: #64b5f6; --text: #e0e0e0;
            --dim: #9e9e9e; --success: #81c784; --border: #333; --danger: #ef5350;
        }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); color: var(--text); display: flex; margin: 0; height: 100vh; overflow: hidden; }
        
        /* å´é‚Šæ¬„ */
        .sidebar { width: 320px; border-right: 1px solid var(--border); display: flex; flex-direction: column; background: #161616; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .progress-box { background: #252525; padding: 15px; border-radius: 10px; margin-top: 10px; }
        .progress-text { font-size: 0.85em; color: var(--accent); margin-bottom: 5px; }
        .progress-bar-bg { background: #444; height: 6px; border-radius: 3px; overflow: hidden; }
        .progress-bar-fill { background: var(--accent); height: 100%; transition: width 0.3s; }

        .menu-list { flex-grow: 1; overflow-y: auto; }
        .week-title { padding: 12px 20px; background: #222; font-size: 0.9em; font-weight: bold; color: var(--dim); }
        .day-item { padding: 12px 25px; font-size: 0.85em; cursor: pointer; display: flex; justify-content: space-between; border-bottom: 1px solid #222; }
        .day-item.active { background: #333; color: var(--accent); border-left: 4px solid var(--accent); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #444; align-self: center; }
        .status-dot.done { background: var(--success); }

        /* ä¸»å€åŸŸ */
        .main { flex-grow: 1; overflow-y: auto; padding: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .video-box { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; margin-bottom: 30px; border: 1px solid var(--border); }
        
        /* å­¸ç¿’å€å¡Š */
        .task-card { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border); }
        .sentence-text { font-size: 1.2em; color: var(--accent); margin: 10px 0; font-style: italic; }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button { border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 6px; transition: 0.2s; }
        .btn-play { background: #444; color: white; }
        .btn-rec { background: var(--accent); color: #000; }
        .btn-rec.recording { background: var(--danger); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* æ­·å²ç´€éŒ„èˆ‡è©•åˆ† */
        .history-box { margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px; }
        .audio-item { background: #252525; padding: 15px; border-radius: 10px; margin-bottom: 12px; position: relative; border: 1px solid #333; }
        .audio-info { font-size: 0.8em; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .score-tag { color: #ffca28; font-weight: bold; font-size: 1.1em; }
        .btn-delete { background: none; color: var(--dim); padding: 5px; font-size: 1.2em; }
        .btn-delete:hover { color: var(--danger); }
        audio { height: 35px; width: calc(100% - 40px); filter: invert(90%); }
        
        .vocab-list { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .vocab-item { background: #333; padding: 5px 10px; border-radius: 15px; font-size: 0.85em; display: flex; align-items: center; gap: 5px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h3 style="margin:0">English Studio</h3>
        <div class="progress-box">
            <div id="progress-text" class="progress-text">å·²å®Œæˆ 0 å¤© / 84 å¤© (0%)</div>
            <div class="progress-bar-bg"><div id="progress-fill" class="progress-bar-fill" style="width:0%"></div></div>
        </div>
    </div>
    <div id="menu" class="menu-list"></div>
</div>

<div class="main">
    <div id="content" style="display:none" class="container">
        <h2 id="day-label" style="margin:0; color:var(--accent)"></h2>
        <h1 id="day-topic" style="margin: 10px 0 20px 0"></h1>

        <div class="video-box"><div id="player"></div></div>

        <div id="tasks-container"></div>

        <div class="history-box">
            <h3>ğŸ“œ æ­·å²è©•åˆ†èˆ‡éŸ³æª”</h3>
            <div id="history-list"></div>
        </div>
    </div>
</div>

<script>
    let player, db, isRecording = false;
    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    // IndexedDB åˆå§‹åŒ–
    const request = indexedDB.open("EnglishStudioDB", 2);
    request.onupgradeneeded = e => {
        db = e.target.result;
        if (!db.objectStoreNames.contains("recordings")) {
            db.createObjectStore("recordings", { keyPath: "id", autoIncrement: true });
        }
    };
    request.onsuccess = e => { db = e.target.result; loadHistory(); };

    // æ•¸æ“šç¯„ä¾‹ (è£œé½Šæ ¼å¼)
    // è£œé½Š 12 é€±å®Œæ•´å­¸ç¿’æ•¸æ“š
const planData = [
    {
        week: "ç¬¬ä¸€å€‹æœˆï¼šè‡ªç„¶ç•Œä¹‹è§€å¯Ÿè€…",
        days: [
            { id: "w1d1", label: "W1D1", topic: "ç”Ÿå‘½æ˜¯ä»€éº¼ï¼Ÿ", vid: "Gy60BqCnTG4", start: 0, 
              tasks: [
                { sentence: "Living things need to breathe.", vocab: ["Living", "Breathe"] },
                { sentence: "A rock cannot grow.", vocab: ["Rock", "Grow"] },
                { sentence: "All living things change over time.", vocab: ["Change", "Energy"] }
              ] 
            },
            { id: "w1d2", label: "W1D2", topic: "æ¤ç‰©çš„æˆé•·", vid: "tkFPyue5X3Q", start: 30, 
              tasks: [
                { sentence: "Seeds grow roots first.", vocab: ["Seed", "Root"] },
                { sentence: "The stem helps the plant stand up.", vocab: ["Stem", "Stand"] },
                { sentence: "Leaves need sunlight to make food.", vocab: ["Leaf", "Sunlight"] }
              ] 
            },
            { id: "w1d3", label: "W1D3", topic: "è½è‘‰çš„é¡è‰²", vid: "Xk4-6II8l5Q", start: 60, 
              tasks: [
                { sentence: "Chlorophyll makes leaves green.", vocab: ["Autumn", "Chlorophyll"] },
                { sentence: "Trees rest during the winter.", vocab: ["Green", "Rest"] },
                { sentence: "Leaves turn red and orange in autumn.", vocab: ["Sugar", "Autumn"] }
              ] 
            },
            { id: "w1d4", label: "W1D4", topic: "åœŸå£¤çš„ç§˜å¯†", vid: "Q-J2FErZHuA", start: 45, 
              tasks: [
                { sentence: "Soil is full of nutrients.", vocab: ["Soil", "Nutrient"] },
                { sentence: "Worms help keep the soil healthy.", vocab: ["Worm", "Healthy"] },
                { sentence: "Plants need good soil to grow.", vocab: ["Garden", "Grow"] }
              ] 
            },
            { id: "w1d5", label: "W1D5", topic: "é£ŸèŸ²æ¤ç‰©", vid: "6L_p3ZkSlLo", start: 75, 
              tasks: [
                { sentence: "Some plants eat insects.", vocab: ["Carnivorous", "Trap"] },
                { sentence: "The trap is very sticky.", vocab: ["Insect", "Sticky"] },
                { sentence: "The plant digests the fly.", vocab: ["Digest", "Fly"] }
              ] 
            },
            { id: "w2d1", label: "W2D1", topic: "è—é¯¨å¥‡è§€", vid: "dciLg3Zm1hI", start: 0, 
              tasks: [
                { sentence: "The blue whale is the biggest mammal.", vocab: ["Mammal", "Ocean"] },
                { sentence: "Its heart is as big as a car.", vocab: ["Giant", "Heart"] },
                { sentence: "It breathes through a blowhole.", vocab: ["Blowhole", "Breathe"] }
              ] 
            },
            { id: "w2d2", label: "W2D2", topic: "ä¼éµå®¶æ—", vid: "T8Wp2yWH_3E", start: 40, 
              tasks: [
                { sentence: "Penguins live in the cold Antarctica.", vocab: ["Antarctica", "Feather"] },
                { sentence: "They use feathers to stay warm.", vocab: ["Slide", "Warm"] },
                { sentence: "They dive deep into the ocean.", vocab: ["Dive", "Group"] }
              ] 
            },
            { id: "w2d3", label: "W2D3", topic: "æµ·æ´‹åˆ†å±¤", vid: "fHVE4B-UjmM", start: 60, 
              tasks: [
                { sentence: "The top zone has the most sunlight.", vocab: ["Sunlight", "Twilight"] },
                { sentence: "Many strange fish live in the dark.", vocab: ["Deep", "Dark"] },
                { sentence: "Water pressure is high in the deep sea.", vocab: ["Pressure", "Sea"] }
              ] 
            },
            { id: "w2d4", label: "W2D4", topic: "è°æ˜æµ·è±š", vid: "hREPV58WNp0", start: 30, 
              tasks: [
                { sentence: "Dolphins are very intelligent animals.", vocab: ["Intelligent", "Pod"] },
                { sentence: "They live together in a pod.", vocab: ["Sound", "Jump"] },
                { sentence: "They use sounds to talk to each other.", vocab: ["Friendly", "Talk"] }
              ] 
            },
            { id: "w2d5", label: "W2D5", topic: "å¥‡æ€ªæ·±æµ·é­š", vid: "A7LU5Wxc_0Y", start: 60, 
              tasks: [
                { sentence: "The blobfish looks very strange.", vocab: ["Blobfish", "Strange"] },
                { sentence: "It lives deep under the ocean.", vocab: ["Appearance", "Deep"] },
                { sentence: "It floats above the sea floor.", vocab: ["Float", "Floor"] }
              ] 
            },
            { id: "w3d1", label: "W3D1", topic: "è´è¶è›»è®Š", vid: "V5RSpMQQOpw", start: 60, 
              tasks: [
                { sentence: "The caterpillar makes a chrysalis.", vocab: ["Caterpillar", "Chrysalis"] },
                { sentence: "It changes into a butterfly.", vocab: ["Butterfly", "Change"] },
                { sentence: "Its wings are very beautiful.", vocab: ["Wings", "Beautiful"] }
              ] 
            },
            { id: "w3d2", label: "W3D2", topic: "å¿™ç¢Œèœœèœ‚", vid: "ta154f5Rp5Y", start: 30, 
              tasks: [
                { sentence: "Bees collect pollen from flowers.", vocab: ["Pollen", "Nectar"] },
                { sentence: "They bring nectar back to the hive.", vocab: ["Hive", "Honey"] },
                { sentence: "The queen bee is very important.", vocab: ["Queen", "Important"] }
              ] 
            },
            { id: "w3d3", label: "W3D3", topic: "èœ˜è››æœ‹å‹", vid: "3qdxEiIB_Sw", start: 90, 
              tasks: [
                { sentence: "Spiders use silk to make webs.", vocab: ["Spider", "Web"] },
                { sentence: "They have eight legs.", vocab: ["Silk", "Eight"] },
                { sentence: "Most spiders are not dangerous to us.", vocab: ["Predator", "Safe"] }
              ] 
            },
            { id: "w3d4", label: "W3D4", topic: "èèŸ»å¸åœ‹", vid: "dTmlE9Cduj4", start: 0, 
              tasks: [
                { sentence: "Ants live together in a colony.", vocab: ["Colony", "Tunnel"] },
                { sentence: "They dig tunnels under the ground.", vocab: ["Worker", "Ground"] },
                { sentence: "Ants can carry very heavy things.", vocab: ["Strong", "Carry"] }
              ] 
            },
            { id: "w3d5", label: "W3D5", topic: "è¢ç«èŸ²ä¹‹å…‰", vid: "Y7RI1qjB2r8", start: 60, 
              tasks: [
                { sentence: "Fireflies flash their lights at night.", vocab: ["Flash", "Light"] },
                { sentence: "They use light to talk to friends.", vocab: ["Signal", "Night"] },
                { sentence: "The light comes from their tails.", vocab: ["Tail", "Friend"] }
              ] 
            },
            { id: "w4d1", label: "W4D1", topic: "æ£®æ—å¤§è²“", vid: "8cQmky_wQao", start: 45, 
              tasks: [
                { sentence: "Lions are called the king of beasts.", vocab: ["Lion", "King"] },
                { sentence: "Tigers have stripes on their fur.", vocab: ["Tiger", "Fur"] },
                { sentence: "Big cats are powerful predators.", vocab: ["Predator", "Roar"] }
              ] 
            },
            { id: "w4d2", label: "W4D2", topic: "çŒ©çŒ©ç”Ÿæ´»", vid: "rHhSCO5-3Pg", start: 0, 
              tasks: [
                { sentence: "Gorillas live in the deep forest.", vocab: ["Gorilla", "Forest"] },
                { sentence: "They live in a group called a troop.", vocab: ["Social", "Troop"] },
                { sentence: "They are very gentle giants.", vocab: ["Gentle", "Giant"] }
              ] 
            },
            { id: "w4d3", label: "W4D3", topic: "ç„¡å°¾ç†Šæ•£ç†±", vid: "JnZTNWbQsKQ", start: 30, 
              tasks: [
                { sentence: "Koalas live in Australia.", vocab: ["Koala", "Australia"] },
                { sentence: "They hug trees to stay cool.", vocab: ["Cool", "Hug"] },
                { sentence: "They love to eat eucalyptus leaves.", vocab: ["Eucalyptus", "Leaf"] }
              ] 
            },
            { id: "w4d4", label: "W4D4", topic: "æ¨¹æ‡¶å¥§ç§˜", vid: "eq42qcpTo1o", start: 75, 
              tasks: [
                { sentence: "Sloths are the slowest mammals.", vocab: ["Sloth", "Slow"] },
                { sentence: "They spend most time on branches.", vocab: ["Jungle", "Branch"] },
                { sentence: "They sleep for a long time.", vocab: ["Sleep", "Time"] }
              ] 
            },
            { id: "w4d5", label: "W4D5", topic: "è°æ˜çƒé´‰", vid: "XofnexWvBN0", start: 45, 
              tasks: [
                { sentence: "Crows are very clever birds.", vocab: ["Crow", "Clever"] },
                { sentence: "They can use tools to get food.", vocab: ["Tool", "Food"] },
                { sentence: "They are good at solving problems.", vocab: ["Problem", "Brain"] }
              ] 
            }
        ]
    }
    // è¨»ï¼šæ‚¨å¯ä»¥ç¹¼çºŒæŒ‰æ­¤æ ¼å¼è£œé½Šç¬¬ 5 é€±è‡³ç¬¬ 12 é€±çš„æ•¸æ“šã€‚
];

    function renderSidebar() {
        const menu = document.getElementById('menu');
        const history = JSON.parse(localStorage.getItem('study_done') || '[]');
        menu.innerHTML = '';
        planData.forEach(w => {
            const wt = document.createElement('div');
            wt.className = 'week-title'; wt.innerText = w.week; menu.appendChild(wt);
            w.days.forEach(d => {
                const di = document.createElement('div');
                di.className = `day-item ${history.includes(d.id) ? 'active' : ''}`;
                di.innerHTML = `<span>${d.label} ${d.topic}</span><div class="status-dot ${history.includes(d.id)?'done':''}"></div>`;
                di.onclick = () => loadDay(d); menu.appendChild(di);
            });
        });
        const percent = Math.round((history.length / 84) * 100);
        document.getElementById('progress-text').innerText = `å·²å®Œæˆ ${history.length} å¤© / 84 å¤© (${percent}%)`;
        document.getElementById('progress-fill').style.width = percent + '%';
    }

    function loadDay(day) {
        document.getElementById('content').style.display = 'block';
        document.getElementById('day-label').innerText = day.label;
        document.getElementById('day-topic').innerText = day.topic;
        const container = document.getElementById('tasks-container');
        container.innerHTML = '';
        
        day.tasks.forEach(task => {
            const card = document.createElement('div');
            card.className = 'task-card';
            card.innerHTML = `
                <div class="vocab-list">${task.vocab.map(v => `
                    <div class="vocab-item">
                        <span>${v}</span>
                        <button class="btn-play" onclick="speak('${v}')">ğŸ”Š</button>
                        <button class="btn-rec" onclick="startChallenge(this, '${v}')">ğŸ¤</button>
                    </div>`).join('')}
                </div>
                <div class="sentence-text">"${task.sentence}"</div>
                <div class="btn-group">
                    <button class="btn-play" onclick="speak('${task.sentence}')">ğŸ”Š è†è½å¥å­</button>
                    <button class="btn-rec" onclick="startChallenge(this, '${task.sentence}')">ğŸ¤ éŒ„éŸ³è©•åˆ†</button>
                </div>
            `;
            container.appendChild(card);
        });

        if (player) player.loadVideoById({ videoId: day.vid, startSeconds: day.start });
        let done = JSON.parse(localStorage.getItem('study_done') || '[]');
        if(!done.includes(day.id)) { done.push(day.id); localStorage.setItem('study_done', JSON.stringify(done)); renderSidebar(); }
    }

    function speak(text) {
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US'; speechSynthesis.speak(msg);
    }

    // æ ¸å¿ƒåŠŸèƒ½ï¼šéŒ„éŸ³ + è¾¨è­˜è©•åˆ†
    let mediaRecorder, chunks = [], currentRecognition;

    function startChallenge(btn, targetText) {
        if (isRecording) return;
        isRecording = true;
        btn.classList.add('recording');
        btn.innerText = "ğŸ›‘ æ­£åœ¨è©•åˆ†...";

        let finalScore = "â­"; // é è¨­ 1 æ˜Ÿ
        let recognizedText = "";

        // å•Ÿå‹•è¾¨è­˜
        if (Recognition) {
            currentRecognition = new Recognition();
            currentRecognition.lang = 'en-US';
            currentRecognition.onresult = e => {
                recognizedText = e.results[0][0].transcript.toLowerCase();
                const target = targetText.toLowerCase().replace(/[.,!?]/g, '');
                // è©•åˆ†é‚è¼¯
                if (recognizedText === target) finalScore = "â­â­â­â­â­ (Perfect!)";
                else if (target.includes(recognizedText) || recognizedText.includes(target)) finalScore = "â­â­â­ (Good)";
                else finalScore = "â­ (Try Again)";
            };
            currentRecognition.start();
        }

        // å•Ÿå‹•éŒ„éŸ³
        navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
            mediaRecorder = new MediaRecorder(stream);
            chunks = [];
            mediaRecorder.ondataavailable = e => chunks.push(e.data);
            mediaRecorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'audio/webm' });
                saveRecord(blob, targetText, finalScore, recognizedText);
                isRecording = false;
                btn.classList.remove('recording');
                btn.innerHTML = btn.classList.contains('btn-play') ? "ğŸ”Š è†è½" : "ğŸ¤ éŒ„éŸ³è©•åˆ†";
            };
            mediaRecorder.start();
            setTimeout(() => { 
                mediaRecorder.stop(); 
                if(currentRecognition) currentRecognition.stop(); 
            }, 4000);
        });
    }

    function saveRecord(blob, label, score, transcript) {
        const reader = new FileReader();
        reader.readAsDataURL(blob);
        reader.onloadend = () => {
            const transaction = db.transaction(["recordings"], "readwrite");
            transaction.objectStore("recordings").add({
                label: label, score: score, transcript: transcript,
                data: reader.result, time: new Date().toLocaleString()
            });
            transaction.oncomplete = () => loadHistory();
        };
    }

    function loadHistory() {
        if(!db) return;
        const list = document.getElementById('history-list');
        list.innerHTML = '';
        const store = db.transaction("recordings").objectStore("recordings");
        store.openCursor(null, "prev").onsuccess = e => {
            const cursor = e.target.result;
            if (cursor) {
                const div = document.createElement('div');
                div.className = 'audio-item';
                div.innerHTML = `
                    <div class="audio-info">
                        <div>
                            <strong>${cursor.value.label}</strong><br>
                            <span class="score-tag">${cursor.value.score}</span>
                            <span style="font-size:0.8em; color:var(--dim)"> | ä½ èªªçš„æ˜¯: "${cursor.value.transcript || '...'}"</span>
                        </div>
                        <button class="btn-delete" onclick="deleteRecord(${cursor.value.id})">ğŸ—‘ï¸</button>
                    </div>
                    <audio controls src="${cursor.value.data}"></audio>
                `;
                list.appendChild(div);
                cursor.continue();
            }
        };
    }

    function deleteRecord(id) {
        if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†ç·´ç¿’ç´€éŒ„å—ï¼Ÿ")) {
            const transaction = db.transaction(["recordings"], "readwrite");
            transaction.objectStore("recordings").delete(id);
            transaction.oncomplete = () => loadHistory();
        }
    }

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', { height: '100%', width: '100%', videoId: 'Gy60BqCnTG4' });
        renderSidebar();
    }

    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);
</script>
</body>
</html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è‹±é›„è‹±èªï¼šæ·±è‰²è­·çœ¼ç‰ˆ</title>
    <style>
        /* 1. æ¥µç°¡æ·±è‰²æ¨¡å¼é…è‰² */
        :root {
            --bg-dark: #121212;
            --card-dark: #1e1e1e;
            --text-main: #e0e0e0;
            --text-dim: #b0b0b0;
            --accent: #64b5f6;
            --success: #81c784;
            --border: #333333;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            display: flex;
            margin: 0;
            height: 100vh;
            background: var(--bg-dark);
            color: var(--text-main);
        }

        /* å´é‚Šæ¬„ */
        .sidebar { width: 300px; background: #161616; border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 25px; border-bottom: 1px solid var(--border); }
        .menu-list { flex-grow: 1; overflow-y: auto; padding-bottom: 50px; }
        .week-section { padding: 15px 20px; background: #1d1d1d; cursor: pointer; font-weight: bold; font-size: 0.9em; display: flex; justify-content: space-between; border-bottom: 1px solid #222; }
        .day-list { display: none; }
        .day-list.active { display: block; }
        .menu-item { padding: 12px 30px; cursor: pointer; color: var(--text-dim); font-size: 0.85em; display: flex; align-items: center; justify-content: space-between; }
        .menu-item:hover { background: #252525; color: var(--accent); }
        .menu-item.active { background: #2c2c2c; color: var(--accent); border-right: 3px solid var(--accent); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #444; }
        .status-dot.done { background: var(--success); box-shadow: 0 0 5px var(--success); }

        /* ä¸»å…§å®¹ */
        .main-content { flex-grow: 1; padding: 40px; overflow-y: auto; }
        .content-card { max-width: 900px; margin: 0 auto; background: var(--card-dark); padding: 30px; border-radius: 16px; border: 1px solid var(--border); }
        
        /* YouTube å®¹å™¨ */
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; margin: 20px 0; border-radius: 12px; overflow: hidden; background: #000; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* äº’å‹•çµ„ä»¶ */
        .interactive-section { margin-top: 30px; display: grid; gap: 20px; }
        .tool-box { background: #252525; padding: 20px; border-radius: 12px; border: 1px solid var(--border); }
        .vocab-tag { display: inline-block; background: #333; padding: 8px 16px; border-radius: 20px; margin: 5px; cursor: pointer; transition: 0.2s; }
        .vocab-tag:hover { background: var(--accent); color: #000; }

        /* èªéŸ³æŒ‰éˆ• */
        .btn-mic { background: var(--accent); color: #000; border: none; padding: 12px 24px; border-radius: 30px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 10px; margin-top: 15px; }
        .btn-mic:disabled { background: #555; cursor: not-allowed; }
        .result-text { margin-top: 15px; color: var(--success); font-weight: bold; font-size: 1.1em; }
        
        /* éŒ„éŸ³å›æ”¾ */
        .audio-list { margin-top: 10px; border-top: 1px solid #444; padding-top: 10px; }
        audio { height: 35px; width: 100%; filter: invert(90%); margin-top: 5px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h2 style="margin:0; color: var(--accent);">Learning Plan</h2>
        <div id="overall-progress" style="font-size: 0.8em; margin-top: 10px; color: var(--text-dim);"></div>
    </div>
    <div id="menu-list" class="menu-list"></div>
</div>

<div class="main-content">
    <div id="display-area" style="display: none;">
        <div class="content-card">
            <h1 id="day-title" style="margin:0; font-size: 1.5em; color: var(--accent);"></h1>
            <h2 id="topic-title" style="margin: 10px 0; font-size: 1.2em;"></h2>
            
            <div class="video-container">
                <div id="player"></div>
            </div>

            <div class="interactive-section">
                <div class="tool-box">
                    <h3 style="margin-top:0;">ğŸ“š é—œéµå–®å­— (é»æ“Šç™¼éŸ³)</h3>
                    <div id="vocab-container"></div>
                </div>

                <div class="tool-box">
                    <h3 style="margin-top:0;">ğŸ™ï¸ èªéŸ³è¾¨è­˜èˆ‡æŒ‘æˆ°ç´€éŒ„</h3>
                    <p id="target-sentence" style="font-size: 1.2em; color: var(--accent); font-style: italic;"></p>
                    <button id="mic-btn" class="btn-mic">ğŸ¤ é–‹å§‹èªªè©±ç·´ç¿’</button>
                    <div id="recognition-result" class="result-text"></div>
                    
                    <div class="audio-list">
                        <p style="font-size: 0.8em; color: var(--text-dim);">æˆ‘çš„ç·´ç¿’éŸ³æª”å›æ”¾ï¼š</p>
                        <div id="audio-recordings"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // YouTube Player API è¼‰å…¥
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    let currentDayData = null;

    // å®Œæ•´çš„ 12 é€±æ•¸æ“š (å°æ‡‰æ‚¨æä¾›çš„å…§å®¹)
    const planData = [
        {
            week: "W1-W4: è‡ªç„¶ç•Œè§€å¯Ÿè€…",
            days: [
                { id: "1-1", day: "W1D1", title: "ç”Ÿå‘½æ˜¯ä»€éº¼ï¼Ÿ", vid: "Gy60BqCnTG4", start: 0, vocab: ["Living", "Breathe", "Grow", "Change", "Energy"], sentence: "Living things need to breathe." },
                { id: "1-2", day: "W1D2", title: "æ¤ç‰©çš„æˆé•·", vid: "tkFPyue5X3Q", start: 30, vocab: ["Seed", "Root", "Stem", "Leaf", "Sunlight"], sentence: "Seeds grow roots first." },
                { id: "1-3", day: "W1D3", title: "è½è‘‰çš„é¡è‰²", vid: "Xk4-6II8l5Q", start: 60, vocab: ["Autumn", "Chlorophyll", "Green", "Sugar", "Rest"], sentence: "Chlorophyll makes leaves green." },
                { id: "1-4", day: "W1D4", title: "åœŸå£¤çš„ç§˜å¯†", vid: "Q-J2FErZHuA", start: 45, vocab: ["Soil", "Nutrient", "Worm", "Healthy", "Garden"], sentence: "Soil is full of nutrients." },
                { id: "1-5", day: "W1D5", title: "é£ŸèŸ²æ¤ç‰©", vid: "6L_p3ZkSlLo", start: 75, vocab: ["Carnivorous", "Trap", "Insect", "Sticky", "Digest"], sentence: "The plant digests the fly." }
                // ...æ­¤è™•å¯è‡ªè¡ŒæŒ‰æ ¼å¼è£œé½Šè‡³ W12
            ]
        }
    ];

    // åˆå§‹åŒ–å´é‚Šæ¬„
    function initSidebar() {
        const menu = document.getElementById('menu-list');
        const history = JSON.parse(localStorage.getItem('study_history') || '{}');

        planData.forEach((weekGroup, idx) => {
            const header = document.createElement('div');
            header.className = 'week-section';
            header.innerHTML = `<span>${weekGroup.week}</span><span>â–¼</span>`;
            
            const dayList = document.createElement('div');
            dayList.className = 'day-list' + (idx === 0 ? ' active' : '');
            header.onclick = () => dayList.classList.toggle('active');

            weekGroup.days.forEach(day => {
                const item = document.createElement('div');
                item.className = 'menu-item';
                const isDone = history[day.id] ? 'done' : '';
                item.innerHTML = `<span>${day.day}: ${day.title}</span><div class="status-dot ${isDone}"></div>`;
                item.onclick = (e) => {
                    e.stopPropagation();
                    loadDay(day);
                };
                dayList.appendChild(item);
            });
            menu.appendChild(header);
            menu.appendChild(dayList);
        });
    }

    // è¼‰å…¥ç•¶å¤©å…§å®¹
    function loadDay(data) {
        currentDayData = data;
        document.getElementById('display-area').style.display = 'block';
        document.getElementById('day-title').innerText = data.day;
        document.getElementById('topic-title').innerText = data.title;
        document.getElementById('target-sentence').innerText = `Challenge: "${data.sentence}"`;
        document.getElementById('recognition-result').innerText = '';

        // å–®å­—ç™¼éŸ³
        const vBox = document.getElementById('vocab-container');
        vBox.innerHTML = '';
        data.vocab.forEach(v => {
            const span = document.createElement('span');
            span.className = 'vocab-tag';
            span.innerText = v;
            span.onclick = () => speak(v);
            vBox.appendChild(span);
        });

        // YouTube è·³è½‰
        if (player && player.loadVideoById) {
            player.loadVideoById({
                videoId: data.vid,
                startSeconds: data.start
            });
        }
        
        loadSavedAudio(data.id);
    }

    // èªéŸ³ç™¼éŸ³
    function speak(text) {
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US';
        window.speechSynthesis.speak(msg);
    }

    // 3. èªéŸ³è¾¨è­˜è©•åˆ†
    const micBtn = document.getElementById('mic-btn');
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';

        micBtn.onclick = () => {
            recognition.start();
            micBtn.innerText = 'æ­£åœ¨è†è½ä¸­...è«‹æœ—è®€å¥å­';
            micBtn.disabled = true;
        };

        recognition.onresult = (event) => {
            const speechToText = event.results[0][0].transcript.toLowerCase().replace(/[.,!]/g, '');
            const target = currentDayData.sentence.toLowerCase().replace(/[.,!]/g, '');
            
            let score = "â­";
            if(speechToText === target) score = "â­â­â­â­â­ Excellent!";
            else if(target.includes(speechToText)) score = "â­â­â­ Good Try!";

            document.getElementById('recognition-result').innerHTML = `ä½ èªªçš„æ˜¯: "${speechToText}" <br> è©•åˆ†: ${score}`;
            
            // ç´€éŒ„é€²åº¦
            saveProgress(currentDayData.id);
        };

        recognition.onend = () => {
            micBtn.innerText = 'ğŸ¤ é–‹å§‹èªªè©±ç·´ç¿’';
            micBtn.disabled = false;
        };
    }

    // 4. å­¸ç¿’é€²åº¦å„²å­˜
    function saveProgress(id) {
        const history = JSON.parse(localStorage.getItem('study_history') || '{}');
        history[id] = true;
        localStorage.setItem('study_history', JSON.stringify(history));
        location.reload(); // åˆ·æ–°å´é‚Šæ¬„å‹¾é¸ç‹€æ…‹
    }

    // 5. éŒ„éŸ³åŠŸèƒ½å¯¦ç¾ (ç°¡åŒ–ç‰ˆï¼šå„²å­˜ç‚º Base64 åœ¨ LocalStorage)
    let mediaRecorder;
    let chunks = [];

    // è¨»ï¼šçœŸæ­£çš„éŒ„éŸ³å­˜å„²é€šå¸¸éœ€è¦å¾Œç«¯ï¼Œé€™è£¡ç¤ºç¯„å¦‚ä½•éŒ„éŸ³ä¸¦å³æ™‚å›æ”¾
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.onstop = e => {
            const blob = new Blob(chunks, { type: 'audio/ogg; codecs=opus' });
            const audioURL = window.URL.createObjectURL(blob);
            displayAudio(audioURL);
            chunks = [];
        };
    });

    function displayAudio(url) {
        const container = document.getElementById('audio-recordings');
        const audio = document.createElement('audio');
        audio.controls = true;
        audio.src = url;
        container.prepend(audio);
    }

    // YouTube æº–å‚™å¥½å¾Œçš„è™•ç†
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '100%',
            width: '100%',
            videoId: 'Gy60BqCnTG4', // é è¨­é¦–é 
            events: { 'onReady': () => initSidebar() }
        });
    }

    function loadSavedAudio(dayId) {
        document.getElementById('audio-recordings').innerHTML = '';
    }
</script>

</body>
</html>

