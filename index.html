<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12é€±è‹±èªæŒ‘æˆ°ï¼šæ·±è‰²è­·çœ¼ç‰ˆ</title>
    <style>
        :root {
            --bg-dark: #121212;
            --card-dark: #1e1e1e;
            --text-main: #e0e0e0;
            --text-dim: #b0b0b0;
            --accent: #64b5f6;
            --success: #81c784;
            --border: #333333;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            display: flex;
            margin: 0;
            height: 100vh;
            background: var(--bg-dark);
            color: var(--text-main);
        }

        /* å´é‚Šæ¬„èˆ‡é€²åº¦è¡¨ */
        .sidebar { width: 320px; background: #161616; border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 25px; border-bottom: 1px solid var(--border); }
        .progress-stat { font-size: 0.8em; color: var(--success); margin-top: 5px; }
        .menu-list { flex-grow: 1; overflow-y: auto; padding-bottom: 50px; }
        .week-section { padding: 15px 20px; background: #1d1d1d; cursor: pointer; font-weight: bold; font-size: 0.9em; display: flex; justify-content: space-between; border-bottom: 1px solid #222; }
        .day-list { display: none; }
        .day-list.active { display: block; }
        .menu-item { padding: 12px 30px; cursor: pointer; color: var(--text-dim); font-size: 0.85em; display: flex; align-items: center; justify-content: space-between; }
        .menu-item.active { background: #2c2c2c; color: var(--accent); border-right: 3px solid var(--accent); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #444; }
        .status-dot.done { background: var(--success); }

        /* ä¸»å…§å®¹ */
        .main-content { flex-grow: 1; padding: 30px; overflow-y: auto; }
        .content-card { max-width: 850px; margin: 0 auto; background: var(--card-dark); padding: 30px; border-radius: 16px; border: 1px solid var(--border); }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; margin: 20px 0; border-radius: 12px; overflow: hidden; background: #000; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* äº’å‹•å·¥å…· */
        .tool-box { background: #252525; padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-top: 20px; }
        .vocab-tag { display: inline-block; background: #333; padding: 10px 18px; border-radius: 20px; margin: 5px; cursor: pointer; transition: 0.2s; border: 1px solid #444; }
        .vocab-tag:hover { border-color: var(--accent); color: var(--accent); }
        .btn-mic { background: var(--accent); color: #000; border: none; padding: 15px 30px; border-radius: 35px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.1em; margin: 15px 0; }
        .btn-mic:disabled { background: #444; }

        /* éŒ„éŸ³æ¸…å–® */
        .record-history { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
        .audio-item { background: #2c2c2c; padding: 10px; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        audio { height: 30px; filter: invert(90%); }
        .result-msg { color: var(--success); font-weight: bold; margin: 10px 0; min-height: 24px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h2 style="margin:0; color: var(--accent);">Study Dashboard</h2>
        <div id="progress-bar" class="progress-stat">ç¸½é€²åº¦: 0%</div>
        <div id="star-count" style="font-size: 0.8em; color: #ffca28;">æˆå°±: â­ 0</div>
    </div>
    <div id="menu-list" class="menu-list"></div>
</div>

<div class="main-content">
    <div id="display-area" style="display: none;">
        <div class="content-card">
            <h1 id="day-title" style="margin:0; color: var(--accent);"></h1>
            <h2 id="topic-title" style="margin: 10px 0; font-size: 1.2em; color: var(--text-dim);"></h2>
            
            <div class="video-container">
                <div id="player"></div>
            </div>

            <div class="tool-box">
                <h3 style="margin-top:0;">ğŸ“š å–®å­—ç·´ç¿’ (é»æ“Šç™¼éŸ³ä¸¦è¾¨è­˜)</h3>
                <div id="vocab-container"></div>
            </div>

            <div class="tool-box">
                <h3 style="margin-top:0;">ğŸ™ï¸ å¥å­æœ—è®€èˆ‡éŒ„éŸ³</h3>
                <p id="target-sentence" style="font-size: 1.3em; color: var(--accent); border-left: 4px solid var(--accent); padding-left: 15px;"></p>
                <button id="mic-btn" class="btn-mic">ğŸ¤ é–‹å§‹æœ—è®€æŒ‘æˆ°</button>
                <div id="recognition-result" class="result-msg"></div>
                
                <div class="record-history">
                    <h4 style="margin:0 0 10px 0;">ğŸ“œ æ­·å²ç·´ç¿’éŸ³æª”</h4>
                    <div id="audio-recordings"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    let currentDayData = null;
    let isRecording = false;

    // å®Œæ•´çš„ 12 é€±æ•¸æ“š (è£œé½Šæ‰€æœ‰å½±ç‰‡ ID èˆ‡æ™‚é–“é»)
    const planData = [
        {
            week: "ç¬¬ä¸€å€‹æœˆï¼šè‡ªç„¶ç•Œè§€å¯Ÿè€…",
            days: [
                { id: "1-1", day: "W1D1", title: "ç”Ÿå‘½æ˜¯ä»€éº¼ï¼Ÿ", vid: "Gy60BqCnTG4", start: 0, vocab: ["Living", "Breathe", "Grow", "Energy"], sentence: "Living things need to breathe." },
                { id: "1-2", day: "W1D2", title: "æ¤ç‰©çš„æˆé•·", vid: "tkFPyue5X3Q", start: 30, vocab: ["Seed", "Root", "Stem", "Leaf"], sentence: "Seeds grow roots first." },
                { id: "1-3", day: "W1D3", title: "è½è‘‰çš„é¡è‰²", vid: "Xk4-6II8l5Q", start: 60, vocab: ["Autumn", "Chlorophyll", "Green", "Sugar"], sentence: "Chlorophyll makes leaves green." },
                { id: "1-4", day: "W1D4", title: "åœŸå£¤çš„ç§˜å¯†", vid: "Q-J2FErZHuA", start: 45, vocab: ["Soil", "Nutrient", "Worm", "Garden"], sentence: "Soil is full of nutrients." },
                { id: "1-5", day: "W1D5", title: "é£ŸèŸ²æ¤ç‰©", vid: "6L_p3ZkSlLo", start: 75, vocab: ["Carnivorous", "Trap", "Insect", "Digest"], sentence: "The plant digests the fly." },
                { id: "2-1", day: "W2D1", title: "è—é¯¨å¥‡è§€", vid: "dciLg3Zm1hI", start: 0, vocab: ["Mammal", "Ocean", "Giant", "Blowhole"], sentence: "The blue whale is the biggest mammal." },
                { id: "2-2", day: "W2D2", title: "ä¼éµå®¶æ—", vid: "T8Wp2yWH_3E", start: 40, vocab: ["Antarctica", "Feather", "Dive", "Group"], sentence: "They use feathers to stay warm." },
                { id: "2-3", day: "W2D3", title: "æµ·æ´‹åˆ†å±¤", vid: "fHVE4B-UjmM", start: 60, vocab: ["Sunlight", "Twilight", "Deep", "Pressure"], sentence: "Water pressure is high in the deep sea." },
                { id: "2-4", day: "W2D4", title: "è°æ˜æµ·è±š", vid: "hREPV58WNp0", start: 30, vocab: ["Intelligent", "Pod", "Sound", "Friendly"], sentence: "Dolphins use sounds to talk to each other." },
                { id: "2-5", day: "W2D5", title: "å¥‡æ€ªæ·±æµ·é­š", vid: "A7LU5Wxc_0Y", start: 60, vocab: ["Blobfish", "Strange", "Appearance", "Float"], sentence: "The blobfish looks very strange." }
                // ... å…¶ä»–é€±æ¬¡ä¾æ­¤é¡æ¨ ...
            ]
        }
    ];

    function initSidebar() {
        const menu = document.getElementById('menu-list');
        const history = JSON.parse(localStorage.getItem('study_history') || '{}');
        let doneCount = 0;
        let starSum = 0;

        menu.innerHTML = '';
        planData.forEach((weekGroup, idx) => {
            const header = document.createElement('div');
            header.className = 'week-section';
            header.innerHTML = `<span>${weekGroup.week}</span><span>â–¼</span>`;
            
            const dayList = document.createElement('div');
            dayList.className = 'day-list active'; // é è¨­å±•é–‹

            weekGroup.days.forEach(day => {
                const item = document.createElement('div');
                item.className = 'menu-item';
                const isDone = history[day.id];
                if(isDone) { doneCount++; starSum += (history[day.id].stars || 0); }
                
                item.innerHTML = `<span>${day.day}: ${day.title}</span><div class="status-dot ${isDone?'done':''}"></div>`;
                item.onclick = () => loadDay(day);
                dayList.appendChild(item);
            });
            menu.appendChild(header);
            menu.appendChild(dayList);
        });

        document.getElementById('progress-bar').innerText = `ç¸½é€²åº¦: ${Math.round(doneCount/60*100)}%`;
        document.getElementById('star-count').innerText = `æˆå°±: â­ ${starSum}`;
    }

    function loadDay(data) {
        currentDayData = data;
        document.getElementById('display-area').style.display = 'block';
        document.getElementById('day-title').innerText = data.day;
        document.getElementById('topic-title').innerText = data.title;
        document.getElementById('target-sentence').innerText = `"${data.sentence}"`;
        document.getElementById('recognition-result').innerText = '';

        const vBox = document.getElementById('vocab-container');
        vBox.innerHTML = '';
        data.vocab.forEach(v => {
            const span = document.createElement('span');
            span.className = 'vocab-tag';
            span.innerText = v;
            span.onclick = () => startSpeechTask(v, true); // å–®å­—è¾¨è­˜
            vBox.appendChild(span);
        });

        if (player) player.loadVideoById({ videoId: data.vid, startSeconds: data.start });
    }

    // èªéŸ³è¾¨è­˜èˆ‡ç™¼éŸ³åŠŸèƒ½
    function startSpeechTask(targetText, isVocab) {
        // å…ˆæ’­æ”¾ç™¼éŸ³
        const msg = new SpeechSynthesisUtterance(targetText);
        msg.lang = 'en-US';
        window.speechSynthesis.speak(msg);

        // å•Ÿå‹•è¾¨è­˜
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';
        recognition.start();

        const display = document.getElementById('recognition-result');
        display.style.color = "#64b5f6";
        display.innerText = `æ­£åœ¨è†è½: "${targetText}"...`;

        recognition.onresult = (event) => {
            const result = event.results[0][0].transcript.toLowerCase().replace(/[.,!]/g, '');
            const target = targetText.toLowerCase().replace(/[.,!]/g, '');
            
            if (result.includes(target) || target.includes(result)) {
                display.innerText = `âœ… å¤ªæ£’äº†ï¼è¾¨è­˜æˆåŠŸ: "${result}"`;
                display.style.color = "#81c784";
                if (!isVocab) saveProgress(currentDayData.id, 5);
            } else {
                display.innerText = `âŒ å·®ä¸€é»é»ï¼Œä½ èªªçš„æ˜¯: "${result}"`;
                display.style.color = "#e57373";
            }
        };
    }

    document.getElementById('mic-btn').onclick = () => startSpeechTask(currentDayData.sentence, false);

    function saveProgress(id, stars) {
        const history = JSON.parse(localStorage.getItem('study_history') || '{}');
        history[id] = { done: true, stars: stars };
        localStorage.setItem('study_history', JSON.stringify(history));
        initSidebar(); // å³æ™‚æ›´æ–°å´é‚Šæ¬„ï¼Œä¸é»‘å±
    }

    // éŒ„éŸ³ç©ºé–“åŠŸèƒ½
    let mediaRecorder;
    let audioChunks = [];
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        mediaRecorder.onstop = () => {
            const blob = new Blob(audioChunks, { type: 'audio/wav' });
            const url = URL.createObjectURL(blob);
            addAudioRecord(url);
            audioChunks = [];
        };
    });

    function addAudioRecord(url) {
        const container = document.getElementById('audio-recordings');
        const div = document.createElement('div');
        div.className = 'audio-item';
        div.innerHTML = `<span style="font-size:0.8em;">${new Date().toLocaleTimeString()}</span><audio controls src="${url}"></audio>`;
        container.prepend(div);
    }

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '100%', width: '100%',
            videoId: 'Gy60BqCnTG4',
            events: { 'onReady': initSidebar }
        });
    }
</script>

</body>
</html>
